{% extends "base.html" %}
{% load static %}

{% block head %}
    <link rel="stylesheet" href="{% static 'competitions/css/competitions.css' %}">
    <script>
        function updateEventFields(eventData) {
            document.getElementById('title').value = eventData.title || '';
            document.getElementById('description').value = eventData.description || '';
            document.getElementById('start_time').value = eventData.start_time || '';
            document.getElementById('end_time').value = eventData.end_time || '';
        }

        function fetchEventDetails(eventId) {
            if (!eventId) return;
            
            fetch(`/competitions/get_event_details/${eventId}/`)
                .then(response => response.json())
                .then(data => {
                    updateEventFields(data);
                })
                .catch(error => console.error('Error fetching event details:', error));
        }
    </script>
{% endblock %}

{% block content %}
<div class="event-form-container">
    <h2 class="event-form-title">Edit Event</h2>

    <!-- Dropdown to select an event -->
    <form method="get" class="event-form">
        <div class="form-group">
            <label for="event_id">Select Event:</label>
            <select name="event_id" id="event_id" class="form-control" onchange="fetchEventDetails(this.value)">
                <option value="" selected>Select an event...</option>
                {% for ev in upcoming_events %}
                    <option value="{{ ev.id }}">{{ ev.title }} - {{ ev.start_time|date:"M d, Y H:i" }}</option>
                {% endfor %}
            </select>
        </div>
    </form>

    <!-- Event Edit Form -->
    <form method="post" class="event-form">
        {% csrf_token %}

        <div class="form-group">
            <label for="title">Title:</label>
            <input type="text" id="title" name="title" class="form-control form-input" required>
        </div>

        <div class="form-group">
            <label for="description">Description:</label>
            <textarea id="description" name="description" class="form-control form-input"></textarea>
        </div>

        <div class="form-group">
            <label for="start_time">Start Time:</label>
            <input type="datetime-local" id="start_time" name="start_time" class="form-control form-input" required>
        </div>

        <div class="form-group">
            <label for="end_time">End Time:</label>
            <input type="datetime-local" id="end_time" name="end_time" class="form-control form-input" required>
        </div>

        <div class="form-buttons">
            <button type="submit" class="btn btn-primary">Save Changes</button>
            <a href="{% url 'competitions:calendar_view' %}" class="btn btn-secondary">Cancel</a>
        </div>
    </form>
</div>
{% endblock %}




